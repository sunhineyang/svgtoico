# SVG to ICO 项目多语言架构文档

## 项目概述

SVG to ICO 是一个基于 Next.js 15 构建的多语言在线转换工具，支持将 SVG、PNG、JPG 等格式的图像转换为 ICO 图标格式。项目采用 next-intl 库实现国际化功能，支持英语、俄语、韩语和日语四种语言。

## 多语言架构实现

### 1. 技术栈

- **框架**: Next.js 15.4.6 (使用 App Router)
- **国际化库**: next-intl v4.3.4
- **语言支持**: 英语(en)、俄语(ru)、韩语(ko)、日语(ja)
- **路由策略**: 英语使用根路径(/)，其他语言使用语言前缀(/ru, /ko, /ja)

### 2. 核心配置文件

#### 2.1 路由配置 (`src/i18n/routing.ts`)

```typescript
import { defineRouting } from 'next-intl/routing';

export const routing = defineRouting({
  // 支持的语言列表
  locales: ['en', 'ru', 'ko', 'ja'],
  
  // 默认语言
  defaultLocale: 'en',
  
  // 路由前缀策略：仅非默认语言添加前缀
  localePrefix: 'as-needed',
  
  // 路径映射
  pathnames: {
    '/': '/'
  }
});
```

#### 2.2 请求配置 (`src/i18n/request.ts`)

```typescript
import { getRequestConfig } from 'next-intl/server';
import { routing } from './routing';

export default getRequestConfig(async ({ requestLocale }) => {
  let locale = await requestLocale;
  
  // 确保使用有效的语言
  if (!locale || !routing.locales.includes(locale as any)) {
    locale = routing.defaultLocale;
  }
  
  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default
  };
});
```

#### 2.3 中间件配置 (`middleware.ts`)

```typescript
import createMiddleware from 'next-intl/middleware';
import { routing } from './src/i18n/routing';

export default createMiddleware(routing);

export const config = {
  // 匹配所有路径除了静态文件和API路由
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)', '/', '/(ru|en|ko|ja)/:path*'],
};
```

### 3. 目录结构

```
src/
├── app/
│   ├── [locale]/           # 多语言路由页面
│   │   ├── layout.tsx      # 语言特定布局
│   │   ├── page.tsx        # 主页
│   │   ├── privacy/         # 隐私政策页面
│   │   └── terms/           # 服务条款页面
│   ├── layout.tsx           # 根布局
│   └── page.tsx             # 根页面(重定向)
├── i18n/
│   ├── request.ts           # 请求配置
│   └── routing.ts           # 路由配置
├── i18n.ts                  # 主配置文件
└── components/
    └── common/
        └── language-toggle.tsx  # 语言切换组件

messages/                    # 翻译文件目录
├── en.json                  # 英语翻译
├── ru.json                  # 俄语翻译
├── ko.json                  # 韩语翻译
└── ja.json                  # 日语翻译
```

### 4. 语言切换实现

#### 4.1 语言切换组件 (`src/components/common/language-toggle.tsx`)

语言切换组件实现了以下功能：
- 显示当前语言和国旗图标
- 下拉菜单选择语言
- SEO友好的URL切换
- 客户端路由跳转

关键实现逻辑：
```typescript
const handleLanguageChange = React.useCallback((langCode: string) => {
  // SEO友好的URL结构
  const targetUrl = langCode === 'en' 
    ? window.location.origin + '/'
    : window.location.origin + '/' + langCode;
  
  // 执行页面跳转
  window.location.href = targetUrl;
}, [locale, pathname]);
```

#### 4.2 URL结构

- 英语（默认语言）: `https://svgtoico.org/`
- 其他语言: `https://svgtoico.org/{语言代码}` (例如: `https://svgtoico.org/ru`)

### 5. 翻译文件结构

翻译文件采用嵌套JSON结构，按功能模块组织：

```json
{
  "common": {
    "title": "SVG to ICO & ICO Converter Online",
    "description": "Convert SVG, PNG, JPG files to ICO format...",
    "language": "Language"
  },
  "navigation": {
    "title": "SVG to ICO",
    "home": "Home",
    "converter": "Converter"
  },
  "converter": {
    "title": "Convert Images to ICO",
    "upload": {
      "dragDrop": "Drag and drop your image file here",
      "supported": "Supported formats: SVG, PNG, JPG"
    }
  }
}
```

### 6. SEO优化

#### 6.1 元数据生成

每个语言页面都有独立的元数据：

```typescript
export async function generateMetadata({
  params
}: {
  params: Promise<{ locale: string }>;
}): Promise<Metadata> {
  const { locale } = await params;
  
  const canonicalUrl = locale === 'en' 
    ? 'https://svgtoico.org'
    : `https://svgtoico.org/${locale}`;
  
  return {
    title: "SVG to ICO Converter | PNG to ICO | JPG to ICO...",
    description: "Convert SVG to ICO, PNG to ICO, JPG to ICO...",
    alternates: {
      canonical: canonicalUrl,
      languages: {
        'en': 'https://svgtoico.org',
        'ru': 'https://svgtoico.org/ru',
        'ko': 'https://svgtoico.org/ko',
        'ja': 'https://svgtoico.org/ja',
      },
    },
  };
}
```

#### 6.2 hreflang 标签

通过 `alternates.languages` 自动生成 hreflang 标签，帮助搜索引擎理解多语言页面之间的关系。

### 7. 使用方式

#### 7.1 在组件中使用翻译

```typescript
import { useTranslations } from 'next-intl';

function Component() {
  const t = useTranslations('converter');
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('upload.dragDrop')}</p>
    </div>
  );
}
```

#### 7.2 在服务器组件中使用翻译

```typescript
import { getTranslations } from 'next-intl/server';

async function ServerComponent() {
  const t = await getTranslations('converter');
  
  return (
    <div>
      <h1>{t('title')}</h1>
    </div>
  );
}
```

### 8. 特殊处理

#### 8.1 默认语言路由

英语作为默认语言，不使用语言前缀，这种设计有以下优势：
- 更简洁的URL结构
- 更好的SEO表现
- 符合英语作为主要目标语言的定位

#### 8.2 语言检测与回退

系统通过以下方式确定用户语言：
1. URL路径中的语言代码
2. 浏览器的 `Accept-Language` 头
3. 默认回退到英语

#### 8.3 静态生成

通过 `generateStaticParams()` 预生成所有语言版本的页面：

```typescript
export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}
```

### 9. 性能优化

1. **按需加载翻译**: 只加载当前语言的翻译文件
2. **静态生成**: 预生成所有语言版本，提高加载速度
3. **客户端缓存**: 翻译文件在客户端被缓存，减少重复请求

### 10. 扩展性

当前架构具有良好的扩展性：
- 添加新语言只需在 `routing.ts` 中添加语言代码
- 创建对应的翻译文件
- 更新语言切换组件的语言列表

### 11. 最佳实践

1. **翻译键命名**: 使用嵌套结构，按功能模块组织
2. **参数化翻译**: 支持动态参数插入
3. **SEO友好**: 每个语言版本都有独立的URL和元数据
4. **用户体验**: 保持语言选择状态，提供视觉反馈

## 总结

SVG to ICO 项目的多语言架构采用了 next-intl 库的最佳实践，实现了SEO友好的URL结构、高效的翻译管理和良好的用户体验。通过合理的目录结构和配置，项目具有良好的可维护性和扩展性，能够轻松支持更多语言的添加。

该架构特别适合内容型网站和工具类应用，尤其是那些需要针对不同语言市场进行SEO优化的项目。